---
title: Обслуживание и лучшие практики
description: Обслуживание и оперативные лучшие практики
---


## График регулярного обслуживания

### Ежедневно

- ✅ Контролируйте здоровье бота
- ✅ Проверяйте логи ошибок
- ✅ Пересматривайте подозрительных пользователей
- ✅ Проверьте обработку платежей

### Еженедельно

- ✅ Резервная копия БД
- ✅ Пересматривайте логи доступа пользователей
- ✅ Проверьте использование ресурсов
- ✅ Протестируйте процедуры восстановления

### Ежемесячно

- ✅ Обновите образы Docker
- ✅ Пересмотрите параметры безопасности
- ✅ Аудит разрешений пользователей
- ✅ Планируйте улучшения

### Ежеквартально

- ✅ Полный аудит безопасности
- ✅ Пересмотр и ротация ключей
- ✅ Оптимизация производительности
- ✅ Проверка соответствия

## Резервная копия БД

<Steps>

  <Step title="Ручная резервная копия">
  ```bash
  docker compose exec postgres pg_dump \
    -U remnawave \
    -d remnawave \
    > backup_$(date +%Y%m%d_%H%M%S).sql
  ```
  </Step>
  <Step title="Автоматическая резервная копия">
  Создайте `/usr/local/bin/backup-bot.sh`:
  ```bash
  #!/bin/bash
  DATE=$(date +%Y%m%d_%H%M%S)
  docker compose -f /path/to/docker-compose.yaml exec postgres \
    pg_dump -U remnawave -d remnawave \
    > /backups/bot_$DATE.sql
  gzip /backups/bot_$DATE.sql
  ```
  </Step>
  <Step title="Добавьте в Cron">
  ```bash
  crontab -e
  # Выполнять ежедневно в 2 AM
  0 2 * * * /usr/local/bin/backup-bot.sh
  ```
  </Step>
  <Step title="Протестируйте восстановление">
  ```bash
  # Проверьте, что резервная копия действительна
  gunzip -c backup_20241110_020000.sql.gz | head -100
  ```
  </Step>
</Steps>

## Обновления и升级

### Обновите бота

```bash
# Проверьте обновления
docker pull ghcr.io/jolymmiels/remnawave-telegram-shop-bot:latest

# Обновите
docker compose pull
docker compose down
docker compose up -d

# Проверьте
docker compose logs -f remnawave-telegram-shop-bot
```

### Обновите зависимости

Контролируйте обновления безопасности:

```bash
# Проверьте уязвимости
docker scout cves ghcr.io/jolymmiels/remnawave-telegram-shop-bot

# Обновите базовый образ при обнаружении проблем
docker compose build --pull
```

### Совместимость версий

Всегда проверяйте совместимость перед обновлением:

| Remnawave     | Bot   |
|---------------|-------|
| 1.6           | 2.3.6 |
| 2.0.0 - 2.1.9 | 3.2.4 |
| 2.2.*         | 3.2.5 |
| 2.3.*         | 3.5.* |

## Укрепление безопасности

### Безопасность окружения

```bash
# Никогда не коммитьте .env
echo ".env" >> .gitignore

# Ограничьте разрешения файла
chmod 600 .env

# Используйте сильные пароли
openssl rand -base64 32
```

### Ротация API ключа

```bash
# Каждые 90 дней
1. Сгенерируйте новый ключ в панели платежей/Remnawave
2. Обновите файл .env
3. Перезагрузите бота
4. Удалите старый ключ после проверки
```

### Контроль доступа

- Ограничьте Telegram ID администраторов
- Используйте сильную аутентификацию
- Включите 2FA где доступно
- Контролируйте логи доступа

## Оптимизация производительности

### Оптимизация БД

```bash
# Подключитесь к PostgreSQL
docker compose exec postgres psql -U remnawave -d remnawave

# Проверьте размеры таблиц
SELECT 
  schemaname, 
  tablename, 
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) 
FROM pg_tables 
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

# Vacuum и анализ
VACUUM ANALYZE;

# Проверьте использование индексов
SELECT * FROM pg_stat_user_indexes ORDER BY idx_scan DESC;
```

### Ресурсы сервера

Контролируйте и регулируйте:

```bash
# Проверьте использование
docker stats remnawave-telegram-shop-bot

# Обновите лимиты в docker-compose.yaml
services:
  remnawave-telegram-shop-bot:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
```

## Восстановление после аварии

### Восстановление резервной копии

```bash
# Остановите сервисы
docker compose down

# Восстановите БД
gunzip -c backup_latest.sql.gz | \
  docker compose exec -T postgres \
  psql -U remnawave -d remnawave

# Запустите сервисы
docker compose up -d
```

### Проверка после восстановления

```bash
# Проверьте целостность данных
docker compose exec postgres psql -U remnawave -d remnawave \
  -c "SELECT COUNT(*) FROM subscriptions;"

# Протестируйте бота
docker compose logs -f remnawave-telegram-shop-bot
```

## Планирование ёмкости

Планируйте рост:

```
Текущие пользователи: 1 000
Темп роста: 20% в месяц
Прогноз: 3 200 пользователей через 6 месяцев

Потребности ресурсов:
- БД: +50GB
- Память бота: +200MB
- Сеть: +100Mbps
```

## Документирование

Ведите подробные записи:

- ✅ Изменения конфигурации
- ✅ Инциденты безопасности
- ✅ Проблемы производительности
- ✅ Жалобы пользователей
- ✅ Обновления системы

## Устранение распространённых проблем

| Проблема | Причина | Решение |
|----------|--------|---------|
| Бот медленный | Высокая нагрузка | Масштабируйте ресурсы |
| БД полная | Большие таблицы | Архивируйте старые данные |
| Платежи сбиваются | Проблема API | Проверьте подключение |
| Утечка памяти | Версия с ошибкой | Обновите бота |

## Ресурсы поддержки

- **GitHub Issues**: Сообщайте об ошибках
- **Документация**: Этот сайт
- **Telegram сообщество**: Присоединитесь к группе
- **Коммерческая поддержка**: Доступна (свяжитесь)
