---
title: Управление пользователями
description: Управление пользователями с помощью чёрных и белых списков
---

## Блокировка пользователей

Заблокируйте конкретных пользователей от доступа к боту.

```bash
BLOCKED_TELEGRAM_IDS=123456789,987654321,555555555
```

### Как заблокировать пользователя

1. Получите их Telegram ID
2. Добавьте в `BLOCKED_TELEGRAM_IDS`
3. Перезагрузите бота: `docker compose down && docker compose up -d`

### Когда блокировать

- Спамеры или хулиганы
- Пользователи, пытающиеся совершить мошенничество
- Аккаунты, нарушающие Условия обслуживания
- Подозрительная активность

### Найти Telegram ID пользователя

Пользователи могут найти свой ID:
- Отправить сообщение [@userinfobot](https://t.me/userinfobot)
- Скопировать возвращённый ID
- Поделиться с администратором (если требуется)

## Добавление в белый список пользователей

Разрешить определённым пользователям обойти проверки безопасности.

```bash
WHITELISTED_TELEGRAM_IDS=111111111,222222222,333333333
```

### Как добавить в белый список

1. Получите Telegram ID (см. выше)
2. Добавьте в `WHITELISTED_TELEGRAM_IDS`
3. Изменения вступают в силу немедленно

### Когда добавлять в белый список

- Служебные аккаунты
- Члены команды
- Проверенные партнёры
- Легитимные боты
- VIP клиенты

### Приоритет белого списка

```
Чёрный список > Белый список > Проверки безопасности
```

Если пользователь в обоих списках, он **заблокирован**.

## Фильтрация пользователей

### Встроенное обнаружение

Бот автоматически обнаруживает подозрительные аккаунты:

| Проверка | Описание |
|---------|---------|
| Анализ ключевых слов | Паттерны фишинга/мошенничества |
| Имена аккаунтов | Служебные vs подозрительные |
| Комбинации | Опасные пары ключевых слов |
| Распознавание служб | Разрешить `@CompanySupportAdmin` |

### Ложные срабатывания

Если легитимные пользователи заблокированы:

1. Получите их Telegram ID
2. Добавьте в `WHITELISTED_TELEGRAM_IDS`
3. Перезагрузитесь при необходимости
4. Сообщите проблему на GitHub

## Состояния пользователей

```
Новый пользователь
  ↓
Проверка безопасности
  ├─ Заблокирован → Отказано
  ├─ В белом списке → Разрешено
  └─ Проверка фильтров
      ├─ Подозрительный → Отказано
      └─ OK → Разрешено
```

## Примеры конфигурации

### Строгая безопасность

```bash
# Блокируйте известных спамеров
BLOCKED_TELEGRAM_IDS=123456789,987654321

# Разрешьте только сотрудников
WHITELISTED_TELEGRAM_IDS=111111111,222222222,333333333
```

### Открытый доступ

```bash
# Нет заблокированных пользователей
BLOCKED_TELEGRAM_IDS=

# Белый список для сотрудников
WHITELISTED_TELEGRAM_IDS=111111111
```

### Выборочное доверие

```bash
# Блокируйте конкретных проблемных пользователей
BLOCKED_TELEGRAM_IDS=999999999

# Доверяйте партнёрам
WHITELISTED_TELEGRAM_IDS=111111111,222222222
```

## Мониторинг

Проверьте логи попыток доступа пользователей:

```bash
docker compose logs remnawave-telegram-shop-bot | grep "user\|access\|security"
```

Ищите:
- Сообщения об отказе в доступе
- Неудачные аутентификации
- Подозрительные паттерны
- Повторные попытки

## Лучшие практики

1. **Регулярно пересматривайте** - Обновляйте списки ежеквартально
2. **Документируйте изменения** - Ведите записи о причинах блокировок
3. **Архивируйте историю** - Отслеживайте решения для апелляций
4. **Контролируйте активность** - Наблюдайте за паттернами злоупотреблений
5. **Взаимодействие** - Сообщайте с доверенными пользователями

## Устранение неполадок

### Заблокированный пользователь всё ещё может получить доступ

- Очистите кэш браузера
- Проверьте формат конфигурации (запятые, нет пробелов)
- Проверьте завершение перезагрузки
- Проверьте логи на предмет ошибок

### Белый список не работает

- Чёрный список требует перезагрузки? Да
- Белый список работает немедленно
- Проверьте формат ID (только цифры)
- Проверьте на опечатки

### Слишком много ложных срабатываний

- Отрегулируйте параметры безопасности
- Добавьте легитимные аккаунты в белый список
- Обновите бот до последней версии
- Сообщите на GitHub

## Апелляции

Ошибочно заблокированные пользователи могут:
1. Связаться с администратором
2. Предоставить объяснение
3. Получить добавление в белый список или разблокировку
4. Администратор документирует причину
