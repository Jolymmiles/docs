---
title: Подписки и пробные периоды
description: Управление подписками и система пробных периодов
---

## Жизненный цикл подписки

### Покупка
1. Пользователь отправляет команду `/start`
2. Просмотреть варианты подписок
3. Выбрать план и способ оплаты
4. Завершить платёж
5. Получить конфигурацию

### Активная
- Пользователь подключен
- Может купить продление в любое время
- Получает напоминание перед истечением

### Уведомление об истечении
- Отправлено за 3 дня до истечения
- Ежедневно в 16:00 UTC
- На предпочитаемом языке пользователя
- Включает кнопку продления

### Продление
- Пользователь нажимает кнопку продления
- Следует процессу платежа снова
- Нет перерыва в обслуживании

## Конфигурация системы пробных периодов

### Включить пробные периоды

```bash
TRIAL_DAYS=7
TRIAL_TRAFFIC_LIMIT=10
TRIAL_REMNAWAVE_TAG=trial_user
```

### Как это работает

1. **Новый пользователь**: Автоматически предлагается пробный период
2. **Длительность пробы**: 7 дней (настраивается)
3. **Лимит трафика**: 10 ГБ (настраивается)
4. **Отслеживание**: Отдельный тег в Remnawave

### Конфигурация сквадов пробного периода

Пробные периоды могут использовать разные сквады:

```bash
TRIAL_INTERNAL_SQUADS=abc12345-def6-7890-ghij-klmnopqrstuv
TRIAL_EXTERNAL_SQUAD_UUID=xyz98765-abc4-3210-defg-hijklmnopqrs
```

## Лимиты трафика

Контролируйте использование пропускной способности:

```bash
TRAFFIC_LIMIT=100          # Обычные пользователи: 100 ГБ
TRIAL_TRAFFIC_LIMIT=10     # Пробные пользователи: 10 ГБ
```

- **0** = Неограниченный трафик
- Единицы в **ГБ**
- Контролируется за подписку
- Применяется панелью

## Состояния подписки

```
Активна → (за 24h) → Вот-вот истекает → Истекла
  ↓
  └→ Продление → Активна
```

Пользователи могут:
- ✅ Просмотреть статус подписки в любое время
- ✅ Продлить, если нужно
- ✅ Переключить способ оплаты

## Устранение неполадок

**Пользователь не получает напоминание**
- Проверьте системное время (16:00 UTC)
- Проверьте действительность токена Telegram
- Проверьте предпочтение языка пользователя

**Пробный период не активируется**
- Проверьте `TRIAL_DAYS > 0`
- Проверьте подключение Remnawave
- Просмотрите логи на предмет ошибок

**Не получается продлить подписку**
- Убедитесь, что способ оплаты включен
- Проверьте, нет ли проблем с балансом пользователя
- Проверьте подключение к панели Remnawave
